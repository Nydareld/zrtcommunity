{% extends 'layout.html' %}

{% block content %}
<div id="lalist" class="box jplist">

    <div class="jplist-panel box panel-top droite" style="margin-bottom:20px;">

        <div
    	   class="jplist-drop-down"
           data-control-type="items-per-page-drop-down"
    	   data-control-name="paging"
    	   data-control-action="paging">
           <ul>
               <li><span data-number="5"> 5 par page </span></li>
               <li><span data-number="10" data-default="true"> 10 par page </span></li>
               <li><span data-number="20"> 20 par page </span></li>
               <li><span data-number="all"> view all </span></li>
           </ul>
    				</div>

    				<div
    				   class="jplist-label"
    				   data-type="{start} - {end} de {all}"
    				   data-control-type="pagination-info"
    				   data-control-name="paging"
    				   data-control-action="paging">
                   </div>

    				<div
    				   class="jplist-pagination"
    				   data-control-type="pagination"
    				   data-control-name="paging"
    				   data-control-action="paging">
    				</div>

    </div>

<div class=" list box">
<table class="table topic-message list-item box">
    <tr>
        <td class="cell-stat-2x topic-member">
            {{topic.messages[0].auteur.username}}
            <br/>
            {{topic.messages[0].auteur.roleHumain}}
        </td>
        <td class="topic-message-contenu">
            <h3 class="topic-message-title">{{topic.name}}</h3>
            <p class="topic-message-date">le {{topic.messages[0].date.format('Y-m-d')}} à {{topic.messages[0].date.format('H:i:s')}}</p>
            <hr/>
            {{topic.messages[0].contenu|raw}}
        </td>
    </tr>
</table>
{% for message in topic.messages[1:] %}
<table class="table topic-message list-item box">
    <tr>
        <td class="cell-stat-2x topic-member">{{message.auteur.username}}</td>
        <td class="topic-message-contenu">
            {% if app.security.token and is_granted('IS_AUTHENTICATED_FULLY') and app.security.token.user == message.auteur %}
            <component class="droite">
            <a href="{{ app.request.basepath }}/forum/editmessage/{{message.id}}">
                <input type="submit" value="éditer"></input>
            </a>
            </component>
            <hr/>
            {% endif %}
            {{message.contenu|raw}}
            <hr/>
            <p class="topic-message-date">le {{message.date.format('Y-m-d')}} à {{message.date.format('H:i:s')}}</p>
        </td>
    </tr>
</table>
{% endfor %}
</div>


<div class="jplist-panel box panel-bottom droite" style="margin-bottom:20px;">

    <div
	   class="jplist-drop-down"
       data-control-type="items-per-page-drop-down"
	   data-control-name="paging"
	   data-control-action="paging">
       <ul>
           <li><span data-number="5"> 5 par page </span></li>
           <li><span data-number="10" data-default="true"> 10 par page </span></li>
           <li><span data-number="20"> 20 par page </span></li>
           <li><span data-number="all"> view all </span></li>
       </ul>
				</div>

				<div
				   class="jplist-label"
				   data-type="{start} - {end} de {all}"
				   data-control-type="pagination-info"
				   data-control-name="paging"
				   data-control-action="paging">
               </div>

				<div
				   class="jplist-pagination"
				   data-control-type="pagination"
				   data-control-name="paging"
				   data-control-action="paging">
				</div>

</div>

</div>

{% if app.security.token and is_granted('IS_AUTHENTICATED_FULLY') %}
<table class="table topic-message">
    <tr>
        <td class="cell-stat-2x topic-member">{{ app.security.token.user.username }}</td>
        <td class="topic-message-contenu">
        {{ form(postForm) }}
        </td>
    </tr>
</table>
{% else %}
<table class="table topic-message">
    <tr>
        <td class="cell-stat-2x topic-member"></td>
        <td class="topic-message-contenu">
            <h3>Inscrit toi ou conecte toi pour donner ton avis !</h3>
            <a class="decal" href="{{ path('login') }}">Connexion</a><br/>
            <a class="decal" href="{{ path('inscription') }}">Inscription</a>
        </td>
    </tr>
</table>
{% endif %}

{% endblock %}

{% block includeHead %}
<link href="{{ app.request.basepath }}/lib/free-pagination-bundle/css/jplist-core.min.css" rel="stylesheet" type="text/css" />
<link href="{{ app.request.basepath }}/lib/free-pagination-bundle/css/jplist-pagination-bundle.min.css" rel="stylesheet" type="text/css" />
<link href="{{ app.request.basepath }}/lib/ckeditor-standard/contents.css" rel="stylesheet">
<!--
-->

{% endblock %}

{% block includeJS %}
<script src="{{ app.request.basepath }}/lib/free-pagination-bundle/js/jplist-core.min.js"></script>
<script src="{{ app.request.basepath }}/lib/free-pagination-bundle/js/jplist.pagination-bundle.min.js"></script>
<script src="{{ app.request.basepath }}/lib/ckeditor-standard/ckeditor.js"></script>
<script src="{{ app.request.basepath }}/lib/ckeditor-standard/adapters/jquery.js"></script>

<script>
$('document').ready(function(){

   //check all jPList javascript options
   $( 'textarea#message_contenu' ).ckeditor();
   $('#lalist').jplist({
      itemsBox: '.list'
      ,itemPath: '.list-item'
      ,panelPath: '.jplist-panel'
   });
});


</script>

{% endblock %}
